<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é£¯åº—æ«ƒæª¯äº¤æ¥çœ‹æ¿</title>
    <style>
        :root { --primary: #1a73e8; --success: #34a853; --orange: #e67e22; }
        body { font-family: -apple-system, sans-serif; background: #f0f2f5; padding: 15px; margin: 0; }
        .container { max-width: 600px; margin: auto; background: white; padding: 20px; border-radius: 12px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); }
        h2 { text-align: center; color: var(--primary); margin: 0 0 15px 0; }
        label { display: block; margin-top: 12px; font-size: 14px; color: #555; font-weight: bold; }
        input, select, button { width: 100%; padding: 12px; margin-top: 5px; border-radius: 8px; border: 1px solid #ddd; box-sizing: border-box; font-size: 16px; outline: none; }
        button { background: var(--primary); color: white; border: none; font-weight: bold; cursor: pointer; margin-top: 15px; }
        button:active { transform: scale(0.98); }
        .shuttle-only { background: #fffcf0; padding: 12px; border-radius: 8px; border: 1px solid #f9e4ad; margin-top: 10px; display: none; }
        .tab-box { display: flex; gap: 8px; margin: 20px 0 10px 0; }
        .tab-btn { flex: 1; padding: 12px; font-size: 14px; background: #eee; border-radius: 8px; border: none; cursor: pointer; }
        .tab-btn.active { background: #607d8b; color: white; }
        .item { background: #fff; border-left: 5px solid var(--primary); padding: 12px; margin-top: 10px; border-radius: 4px; box-shadow: 0 1px 3px rgba(0,0,0,0.1); position: relative; }
        .btn-done { position: absolute; right: 10px; top: 12px; width: 60px; padding: 6px; font-size: 12px; background: var(--success); color: white; border-radius: 4px; border: none; }
        .history-tag { color: var(--success); font-size: 11px; margin-top: 5px; border-top: 1px dashed #eee; padding-top: 5px; }
    </style>
</head>
<body onload="loadData('current')">

<div class="container">
    <h2>ğŸ¨ é£¯åº—æ«ƒæª¯äº¤æ¥çœ‹æ¿</h2>
    
    <div id="inputSection">
        <label>ğŸ“… é è¨ˆæ—¥æœŸ</label>
        <input type="date" id="targetDate">
        
        <label>ğŸ“ æˆ¿è™Ÿ / ä½ç½®</label>
        <input type="text" id="room" placeholder="è¼¸å…¥æˆ¿è™Ÿæˆ–åœ°é»">
        
        <label>ğŸ“‘ äº¤æ¥é¡åˆ¥</label>
        <select id="type" onchange="toggleShuttle()">
            <option value="ğŸ“¦ è¡Œæå¯„æ”¾/æå–">ğŸ“¦ è¡Œæå¯„æ”¾/æå–</option>
            <option value="ğŸš— æ¥é§æœå‹™">ğŸš— æ¥é§æœå‹™</option>
            <option value="ğŸŒŸ VIP/ç‰¹åˆ¥éœ€æ±‚">ğŸŒŸ VIP/ç‰¹åˆ¥éœ€æ±‚</option>
            <option value="ğŸ› ï¸ å®¢æˆ¿ç¶­ä¿®å ±ä¿®">ğŸ› ï¸ å®¢æˆ¿ç¶­ä¿®å ±ä¿®</option>
            <option value="ğŸ§¹ æ¸…æ½”æœå‹™">ğŸ§¹ æ¸…æ½”æœå‹™</option>
            <option value="ğŸ“¢ å…¶ä»–äº‹é …">ğŸ“¢ å…¶ä»–äº‹é …</option>
        </select>

        <div id="shuttleBox" class="shuttle-only">
            <label>ğŸ‘¤ æ¥é§äººå“¡å§“å</label>
            <input type="text" id="driver" placeholder="å¡«å¯«è² è²¬åŒäº‹">
            <label>ğŸ•’ æŠµé”/ç­æ¬¡æ™‚é–“</label>
            <input type="text" id="arrivalTime" placeholder="ä¾‹å¦‚: 14:30 (408æ¬¡)">
        </div>

        <label>ğŸ“ å…§å®¹èªªæ˜</label>
        <input type="text" id="note" placeholder="è©³ç´°äº¤ä»£äº‹é …...">
        <button onclick="saveToCloud()">ç™¼ä½ˆçœ‹æ¿</button>
    </div>

    <div class="tab-box">
        <button id="btnC" class="tab-btn active" onclick="loadData('current')">å¾…è™•ç†äº‹é …</button>
        <button id="btnH" class="tab-btn" onclick="loadData('history')">æ­·å²ç´€éŒ„æŸ¥è©¢</button>
    </div>

    <div id="handoverList"></div>
</div>

<script>
    // å·²æ›´æ–°ç‚ºä½ æä¾›çš„æœ€æ–° API ç¶²å€
    const API_URL = "https://script.google.com/macros/s/AKfycbzw0xAsWTU7q2PyuK3WC3XnaRQ5S6MW-q7f5putbbbHHNsTo2TO5ljQHd-Qj_TDzl6v/exec";

    // æ ¹æ“šé¡åˆ¥åˆ‡æ›æ¥é§æ¬„ä½é¡¯ç¤º
    function toggleShuttle() {
        const isShuttle = document.getElementById('type').value === 'ğŸš— æ¥é§æœå‹™';
        document.getElementById('shuttleBox').style.display = isShuttle ? 'block' : 'none';
    }

    // ç™¼ä½ˆåˆ°é›²ç«¯
    function saveToCloud() {
        const date = document.getElementById('targetDate').value;
        const room = document.getElementById('room').value;
        const note = document.getElementById('note').value;
        if(!date || !room || !note) return alert("è«‹å®Œæ•´å¡«å¯«æ—¥æœŸã€ä½ç½®èˆ‡å…§å®¹ï¼");

        fetch(API_URL, {
            method: "POST",
            mode: "no-cors",
            body: JSON.stringify({ 
                action: "add", 
                date, room, note,
                type: document.getElementById('type').value,
                driver: document.getElementById('driver').value,
                arrivalTime: document.getElementById('arrivalTime').value
            })
        }).then(() => {
            alert("å·²åŒæ­¥è‡³é›²ç«¯ï¼");
            location.reload(); // é‡æ–°æ•´ç†æ¸…ç©ºæ¬„ä½ä¸¦åˆ·æ–°åˆ—è¡¨
        });
    }

    // è™•ç†å®Œæˆï¼ˆç§»å‹•è‡³æ­·å²ç´€éŒ„ï¼‰
    function deleteItem(id) {
        if(!confirm("ç¢ºå®šå·²è™•ç†å®Œæˆï¼Ÿ")) return;
        fetch(API_URL, {
            method: "POST",
            mode: "no-cors",
            body: JSON.stringify({ action: "delete", id: id })
        }).then(() => {
            setTimeout(() => loadData('current'), 1000);
        });
    }

    // è®€å–è³‡æ–™
    function loadData(mode) {
        document.getElementById('btnC').className = (mode === 'current') ? 'tab-btn active' : 'tab-btn';
        document.getElementById('btnH').className = (mode === 'history') ? 'tab-btn active' : 'tab-btn';
        document.getElementById('inputSection').style.display = (mode === 'current') ? 'block' : 'none';

        const listArea = document.getElementById('handoverList');
        listArea.innerHTML = "<p style='text-align:center; color:#999;'>è®€å–é›²ç«¯è³‡æ–™ä¸­...</p>";

        fetch(`${API_URL}?mode=${mode}`)
        .then(res => res.json())
        .then(data => {
            listArea.innerHTML = data.length ? "" : "<p style='text-align:center; color:#999;'>âœ… ç›®å‰ç„¡ç´€éŒ„</p>";
            data.reverse().forEach(row => {
                const isHist = (mode === 'history');
                const shuttleMsg = row[5] ? `<div style="color:var(--orange); font-size:13px; font-weight:bold; margin-top:4px;">ğŸ‘¤ æ¥é§å“¡: ${row[5]} | ğŸ•’ ${row[6]}</div>` : '';
                
                listArea.innerHTML += `
                    <div class="item" style="${isHist ? 'border-left-color:#999; opacity:0.8;' : ''}">
                        <div style="font-size:12px; color:var(--primary); font-weight:bold;">ğŸ“… é è¨ˆæ—¥æœŸ: ${row[1]}</div>
                        <div style="display:flex; justify-content:space-between; margin-top:3px;">
                            <span style="font-weight:bold;">${row[3]} <small style="font-weight:normal;">[${row[2]}]</small></span>
                            <span style="font-size:10px; color:#888;">${row[0]}</span>
                        </div>
                        ${shuttleMsg}
                        <div style="margin-top:5px; font-size:15px;">${row[4]}</div>
                        ${isHist ? `<div class="history-tag">âœ… ${row[7] || 'å·²å­˜æª”'}</div>` : `<button class="btn-done" onclick="deleteItem('${row[0]}')">å®Œæˆ</button>`}
                    </div>`;
            });
        });
    }
</script>

</body>
</html>
